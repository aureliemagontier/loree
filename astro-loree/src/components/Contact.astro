---
import { ContactModel } from '../models/ContactModel';

const contactModel = new ContactModel();
const details = contactModel.getDetails();
---

<section id="contact" class="contact">
    <div class="container">
        <h2 class="section-title">Nous Contacter</h2>
        <div class="contact-grid">
            <div class="contact-info">
                <div class="contact-item">
                    <div class="contact-icon">üìß</div>
                    <div>
                        <h4>Email</h4>
                        <p>{details.email}</p>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon">üì±</div>
                    <div>
                        <h4>T√©l√©phone</h4>
                        <p>{details.phone}</p>
                    </div>
                </div>
                <div class="contact-item">
                    <div class="contact-icon">üåê</div>
                    <div>
                        <h4>R√©seaux Sociaux</h4>
                        <p>@loreedesign</p>
                    </div>
                </div>
            </div>
            <form id="contact-form" class="contact-form">
                <div class="form-group">
                    <input type="text" name="name" placeholder="Votre nom" required>
                </div>
                <div class="form-group">
                    <input type="email" name="email" placeholder="Votre email" required>
                </div>
                <div class="form-group">
                    <textarea name="message" placeholder="Votre message" rows="5" required></textarea>
                </div>
                <button type="submit" class="cta-button">Envoyer le message</button>
                <div id="form-status" class="form-status"></div>
            </form>
        </div>
    </div>
</section>

<script>
    const contactForm = document.getElementById('contact-form');
    const formStatus = document.getElementById('form-status');

    if (contactForm) {
        contactForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const submitBtn = contactForm.querySelector('button[type="submit"]');
            const originalBtnText = submitBtn.textContent;
            
            // UI Update
            submitBtn.disabled = true;
            submitBtn.textContent = 'Envoi en cours...';
            formStatus.textContent = '';
            formStatus.className = 'form-status';

            const formData = new FormData(contactForm);
            const data = Object.fromEntries(formData.entries());

            try {
                // Remplacer l'URL ci-dessous par l'URL de ton Web App Google Apps Script
                const SCRIPT_URL = 'TON_URL_SCRIPT_GOOGLE_ICI';
                
                if (SCRIPT_URL === 'TON_URL_SCRIPT_GOOGLE_ICI') {
                    throw new Error("L'URL du script n'est pas encore configur√©e.");
                }

                const response = await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors', // N√©cessaire pour Google Script
                    body: JSON.stringify(data)
                });

                // Comme mode est 'no-cors', on ne peut pas lire la r√©ponse, 
                // on assume que √ßa a march√© si le fetch n'a pas crash√©
                formStatus.textContent = 'Message envoy√© avec succ√®s ! Merci.';
                formStatus.classList.add('success');
                contactForm.reset();
            } catch (error) {
                console.error('Erreur:', error);
                formStatus.textContent = "Erreur lors de l'envoi. " + error.message;
                formStatus.classList.add('error');
            } finally {
                submitBtn.disabled = false;
                submitBtn.textContent = originalBtnText;
            }
        });
    }
</script>
